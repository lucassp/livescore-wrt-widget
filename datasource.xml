<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author>Lucian Pacurar lucassp@gmail.com</author>
        <description>livescore parser</description>
    </meta>
      <bindings>
        <select produces="XML" >
          <inputs>
               <key id='country' type='xs:string' paramType='variable' required="false" />
          </inputs>
          <execute><![CDATA[
          	var x = y.rest("http://livescore.com/soccer/"+country).accept("text/html").get().response;
                var livedata = y.xpath(x, "/html/body/table/tr[4]/td/table/tr/td[5]/table");
                var output = new XML();
                var newOutput = new XML();
                for each (row in livedata.tr){
	           if (row.td[0].*.length() != 0) {
                       if (row.@bgcolor == '#333333' && row.td[0].@colspan == '4') {
                          if (newSection) {
                             newOutput += newSection;
                          }
                          var newSection = <section></section>;
                          var title = row.td[0].p.*[1].toString() + row.td[0].p.*[2].toString();
                          newSection.title = title;
                          newSection.matchdays = <matchdays></matchdays>;
                       }
                       if (row.@bgcolor == '#333333' && row.td.length() == 2){
                          if (matchDay) {
                             newSection.matchdays += matchDay;
                          }
                          var matchDay = <matchday></matchday>;
                          var time = row.td[0].p.*;
                          var date = row.td[1].p.*;
                          matchDay.time = time;
                          matchDay.date = date;
                       }
		       output += <tr>{row.*}</tr>;
	           }
                }
               response.object = <output>{newOutput}</output>;
      ]]></execute>
      </select>
      </bindings>
</table>