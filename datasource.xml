<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author>Lucian Pacurar lucassp@gmail.com</author>
        <description>livescore parser</description>
    </meta>
      <bindings>
        <select produces="XML" >
          <inputs>
               <key id='country' type='xs:string' paramType='variable' required="false" />
          </inputs>
          <execute><![CDATA[
          	var x = y.rest("http://livescore.com/soccer/"+country).accept("text/html").get().response;
                var livedata = y.xpath(x, "/html/body/table/tr[4]/td/table/tr/td[5]/table");
                var output = new XML();
                var newOutput = new XML();
                for each (row in livedata.tr){
	           if (row.td[0].*.length() != 0) {
		       output += {row};
	           }
                }
                y.log(output);
                for (var i=0; i < output.length(); i++) {
                      if (output[i].@bgcolor == '#333333' && output[i].td[0].@colspan == '4') {
                          if (newSection) {
                             newOutput += newSection;
                          }
                          var newSection = <section></section>;
                          var title = output[i].td[0].p.*[1].toString() + output[i].td[0].p.*[2].toString();
                          newSection.title = title;
                      }
                      if (output[i].@bgcolor == '#333333' && output[i].td.length() == 2){
                          if (matchDay) {
                             newSection.appendChild(matchDay);
                          }
                          var matchDay = <matchday></matchday>;
                          var time = output[i].td[0].p.*;
                          var date = output[i].td[1].p.*;
                          matchDay.time =<time>{time}</time>;
                          matchDay.date =<date>{date}</date>;
                      }
                }
               response.object = <output>{newOutput}</output>;
      ]]></execute>
      </select>
      </bindings>
</table>